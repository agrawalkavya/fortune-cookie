<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Picky Eater - Delhi Eats</title>
  <style>
    body {
      margin: 0;
      background: #ff8b5d;
      font-family: Arial, sans-serif;
      color: #222;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 32px 0 64px 0;
      min-height: 100vh;
    }
    h1, h2 {
      text-align: center;
      margin: 0 0 16px 0;
    }
    .step {
      display: none;
      margin-bottom: 32px;
    }
    .step.active {
      display: block;
    }
    .stick-figures {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 16px;
    }
    .stick-figure {
      font-size: 32px;
      cursor: grab;
      user-select: none;
      transition: opacity 0.2s;
    }
    .stick-figure.dragged {
      opacity: 0.3;
    }
    .stick-dropzone {
      border: 2px dashed #333;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin: 0 auto 16px auto;
      width: 220px;
      background: #fff6f0;
      border-radius: 8px;
    }
    .wallet-area {
      display: flex;
      align-items: flex-end;
      gap: 32px;
      justify-content: center;
      margin-bottom: 24px;
    }
    .wallet-img {
      width: 100px;
      height: 70px;
      background: #2222;
      border-radius: 12px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      position: relative;
      overflow: visible;
    }
    .note {
      width: 40px;
      height: 20px;
      background: #e0ffb3;
      border: 1.5px solid #b2c98b;
      border-radius: 4px;
      margin: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      font-family: monospace;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      cursor: grab;
      z-index: 2;
      transition: top 0.2s, left 0.2s;
    }
    .notes-scatter {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-top: 12px;
      min-height: 60px;
    }
    .map-area {
      text-align: center;
      margin-bottom: 24px;
    }
    .map-region {
      display: inline-block;
      margin: 0 8px;
      padding: 4px 10px;
      border-radius: 6px;
      background: #fff6f0;
      border: 2px solid #bbb;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      transition: background 0.2s, border 0.2s;
    }
    .map-region.selected {
      background: #f87c50;
      border: 2px solid #ff3f3f;
      color: #fff;
    }
    .vending-machine-area {
      text-align: center;
      margin-bottom: 24px;
    }
    .vending-ascii {
      font-family: 'Courier New', Courier, monospace;
      font-size: 15px;
      background: #fff6f0;
      display: inline-block;
      padding: 12px 18px;
      border-radius: 10px;
      margin-bottom: 12px;
    }
    .cuisine-options {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 12px 0;
    }
    .cuisine {
      background: #ffe0b2;
      border: 2px solid #f87c50;
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 15px;
      cursor: grab;
      transition: background 0.2s, border 0.2s;
    }
    .cuisine.selected {
      background: #f87c50;
      color: #fff;
      border: 2px solid #ff3f3f;
    }
    .vending-dropzone {
      margin: 18px auto 0 auto;
      width: 180px;
      height: 38px;
      border: 2px dashed #333;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff6f0;
      font-size: 16px;
      color: #888;
    }
    .fortune-btn {
      display: block;
      margin: 32px auto 0 auto;
      background: #fff;
      border: 2px solid #f87c50;
      border-radius: 50%;
      width: 80px;
      height: 80px;
      background-image: url('fortune-cookie.png');
      background-size: 60px 60px;
      background-repeat: no-repeat;
      background-position: center;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(0,0,0,0.13);
      transition: box-shadow 0.2s;
    }
    .fortune-btn:active {
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
    }
    .receipt-container {
      margin: 32px auto 0 auto;
      width: 340px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.18);
      font-family: 'Courier New', Courier, monospace;
      font-size: 15px;
      padding: 24px 18px 12px 18px;
      border: 1.5px dashed #bbb;
      position: relative;
      display: none;
    }
    .receipt-container.active {
      display: block;
    }
    .receipt-header {
      text-align: center;
      margin-bottom: 8px;
    }
    .receipt-title {
      font-size: 20px;
      font-weight: bold;
      letter-spacing: 1px;
    }
    .receipt-meta {
      font-size: 13px;
      color: #666;
      margin-bottom: 4px;
    }
    .receipt-line {
      border-bottom: 1.5px dashed #bbb;
      margin: 8px 0;
    }
    .receipt-table {
      width: 100%;
    }
    .receipt-row {
      display: flex;
      justify-content: space-between;
      font-size: 15px;
      margin: 2px 0;
    }
    .receipt-row.header {
      font-weight: bold;
      border-bottom: 1px solid #eee;
      margin-bottom: 4px;
    }
    .receipt-footer {
      margin-top: 10px;
      text-align: center;
    }
    .receipt-total {
      font-weight: bold;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .receipt-picky {
      font-size: 13px;
      margin-top: 8px;
    }
    .receipt-picky a {
      color: #f87c50;
      text-decoration: underline;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>picky eater?</h1>
    <!-- Step 1: Number of People -->
    <div class="step active" id="step-people">
      <h2>how many people are there?</h2>
      <div class="stick-figures" id="stick-figures">
        <span class="stick-figure" draggable="true" data-id="1">o<br>|<br>/\<br>/ \</span>
        <span class="stick-figure" draggable="true" data-id="2">o<br>|<br>/|<br>/ \</span>
        <span class="stick-figure" draggable="true" data-id="3">o<br>|<br>/|\<br>/</span>
        <span class="stick-figure" draggable="true" data-id="4">o<br>|<br>/|\<br>/ \</span>
        <span class="stick-figure" draggable="true" data-id="5">o<br>|<br>/|\<br>/ \</span>
      </div>
      <div class="stick-dropzone" id="stick-dropzone">Drop here</div>
      <button id="next-people" style="margin:24px auto 0 auto;display:block;" disabled>Next</button>
    </div>
    <!-- Step 2: Budget -->
    <div class="step" id="step-budget">
      <h2>how much would you like to pay?</h2>
      <div style="text-align:center;font-size:13px;margin-bottom:8px;">(individually after spending an hour on splitwise)</div>
      <div class="wallet-area">
        <div class="wallet-img" id="wallet-img">
          <!-- Placeholder for wallet image -->
          <img src="wallet.png" alt="wallet" style="width:100px;height:70px;position:absolute;left:0;top:0;z-index:1;">
        </div>
        <div class="notes-scatter" id="notes-scatter">
          <!-- Notes will be scattered here -->
        </div>
      </div>
      <div style="text-align:center;margin-bottom:8px;">Drag notes in/out of the wallet</div>
      <div style="text-align:center;font-size:16px;">Current budget: ₹<span id="budget-amount">150</span> per person</div>
      <button id="next-budget" style="margin:24px auto 0 auto;display:block;">Next</button>
    </div>
    <!-- Step 3: Map -->
    <div class="step" id="step-map">
      <h2>where in delhi?</h2>
      <div class="map-area">
        <pre style="font-size:13px;line-height:1.1;margin-bottom:8px;">   _______
  /       \
 / North   \
|           |
| West  C  East |
|           |
 \ South   /
  \_______/</pre>
        <div>
          <span class="map-region" data-region="north">North</span>
          <span class="map-region" data-region="south">South</span>
          <span class="map-region" data-region="east">East</span>
          <span class="map-region" data-region="west">West</span>
          <span class="map-region" data-region="central">Central</span>
        </div>
      </div>
      <button id="next-map" style="margin:24px auto 0 auto;display:block;" disabled>Next</button>
    </div>
    <!-- Step 4: Vending Machine -->
    <div class="step" id="step-vending">
      <h2>vending machine</h2>
      <div class="vending-machine-area">
        <div class="vending-ascii">
          _______________________
         |  __   __   __   __   |
         | |__| |__| |__| |__|  |
         |_____________________|
         |  __   __   __   __  |
         | |__| |__| |__| |__| |
         |_____________________|
         |_____________________|
        </div>
        <div class="cuisine-options" id="cuisine-options">
          <div class="cuisine" draggable="true" data-cuisine="North Indian">North Indian</div>
          <div class="cuisine" draggable="true" data-cuisine="South Indian">South Indian</div>
          <div class="cuisine" draggable="true" data-cuisine="Chinese">Chinese</div>
          <div class="cuisine" draggable="true" data-cuisine="Italian">Italian</div>
          <div class="cuisine" draggable="true" data-cuisine="Desserts">Desserts</div>
          <div class="cuisine" draggable="true" data-cuisine="Random">Random</div>
        </div>
        <div class="vending-dropzone" id="vending-dropzone">Drop cuisine here</div>
      </div>
      <button id="next-cuisine" style="margin:24px auto 0 auto;display:block;" disabled>Next</button>
    </div>
    <!-- Step 5: Fortune Cookie Button -->
    <div class="step" id="step-fortune">
      <h2>ready for your fortune?</h2>
      <button class="fortune-btn" id="fortune-btn"></button>
    </div>
    <!-- Step 6: Receipt -->
    <div class="receipt-container" id="receipt-container">
      <div class="receipt" id="receipt"></div>
    </div>
  </div>
  <script>
    // --- Mock Data ---
    const restaurants = [
      { id: 1, name: 'Chaat Chowk', location: 'Connaught Place', area: 'Central', timings: '10:00 AM - 11:00 PM', cuisine: 'North Indian, Street Food' },
      { id: 2, name: 'South Spice', location: 'Saket', area: 'South', timings: '11:00 AM - 10:00 PM', cuisine: 'South Indian' },
      { id: 3, name: 'Wok Express', location: 'Rajouri Garden', area: 'West', timings: '12:00 PM - 12:00 AM', cuisine: 'Chinese, Asian' },
      { id: 4, name: 'Dolce Vita', location: 'Khan Market', area: 'Central', timings: '10:00 AM - 11:00 PM', cuisine: 'Italian, Desserts' },
      { id: 5, name: 'Sweet Tooth', location: 'Lajpat Nagar', area: 'South', timings: '11:00 AM - 10:00 PM', cuisine: 'Desserts' }
    ];
    const foods = [
      {id: 1, restaurant_id: 1, name: 'Pani Puri', category: 'Appetizer', price: 60},
      {id: 2, restaurant_id: 1, name: 'Aloo Tikki', category: 'Main Course', price: 80},
      {id: 3, restaurant_id: 1, name: 'Lassi', category: 'Drink', price: 50},
      {id: 4, restaurant_id: 2, name: 'Dosa', category: 'Main Course', price: 120},
      {id: 5, restaurant_id: 2, name: 'Filter Coffee', category: 'Drink', price: 40},
      {id: 6, restaurant_id: 2, name: 'Rasam Vada', category: 'Appetizer', price: 70},
      {id: 7, restaurant_id: 3, name: 'Veg Hakka Noodles', category: 'Main Course', price: 150},
      {id: 8, restaurant_id: 3, name: 'Spring Rolls', category: 'Appetizer', price: 90},
      {id: 9, restaurant_id: 3, name: 'Bubble Tea', category: 'Drink', price: 110},
      {id: 10, restaurant_id: 4, name: 'Margherita Pizza', category: 'Main Course', price: 250},
      {id: 11, restaurant_id: 4, name: 'Tiramisu', category: 'Dessert', price: 180},
      {id: 12, restaurant_id: 4, name: 'Pasta Alfredo', category: 'Main Course', price: 220},
      {id: 13, restaurant_id: 5, name: 'Chocolate Cake', category: 'Dessert', price: 120},
      {id: 14, restaurant_id: 5, name: 'Ice Cream', category: 'Dessert', price: 90},
      {id: 15, restaurant_id: 5, name: 'Brownie', category: 'Dessert', price: 100}
    ];

    // --- Step 1: Stick Figures ---
    let selectedPeople = 0;
    const stickFigures = document.querySelectorAll('.stick-figure');
    const stickDropzone = document.getElementById('stick-dropzone');
    const nextPeopleBtn = document.getElementById('next-people');
    let droppedFigures = [];
    function updateStickDropzone() {
      // Remove all children
      while (stickDropzone.firstChild) stickDropzone.removeChild(stickDropzone.firstChild);
      // Add dropped figures
      droppedFigures.forEach(fid => {
        const f = document.querySelector('.stick-figure[data-id="' + fid + '"]');
        if (f) stickDropzone.appendChild(f);
      });
      selectedPeople = droppedFigures.length;
      if (selectedPeople > 0) {
        nextPeopleBtn.disabled = false;
      } else {
        nextPeopleBtn.disabled = true;
        stickDropzone.textContent = 'Drop here';
      }
    }
    stickFigures.forEach(fig => {
      fig.addEventListener('dragstart', e => {
        fig.classList.add('dragged');
        e.dataTransfer.setData('text/plain', fig.dataset.id);
      });
      fig.addEventListener('dragend', e => {
        fig.classList.remove('dragged');
      });
    });
    stickDropzone.addEventListener('dragover', e => {
      e.preventDefault();
    });
    stickDropzone.addEventListener('drop', e => {
      e.preventDefault();
      const id = e.dataTransfer.getData('text/plain');
      if (!droppedFigures.includes(id)) {
        droppedFigures.push(id);
        updateStickDropzone();
      }
    });
    // Allow removing stick figures by clicking them in the dropzone
    stickDropzone.addEventListener('click', e => {
      if (e.target.classList.contains('stick-figure')) {
        const id = e.target.dataset.id;
        droppedFigures = droppedFigures.filter(fid => fid !== id);
        // Move back to original stick-figures row
        document.getElementById('stick-figures').appendChild(e.target);
        updateStickDropzone();
      }
    });
    updateStickDropzone();
    nextPeopleBtn.addEventListener('click', () => {
      if (selectedPeople > 0) {
        document.getElementById('step-people').classList.remove('active');
        document.getElementById('step-budget').classList.add('active');
      }
    });

    // --- Step 2: Wallet & Notes ---
    let notesInWallet = 3;
    let scatteredNotes = 9;
    const walletImg = document.getElementById('wallet-img');
    const notesScatter = document.getElementById('notes-scatter');
    const budgetAmount = document.getElementById('budget-amount');
    function renderNotes() {
      // Clear wallet
      walletImg.querySelectorAll('.note').forEach(n => n.remove());
      // Add notes in wallet
      for (let i = 0; i < notesInWallet; i++) {
        const note = document.createElement('div');
        note.className = 'note';
        note.textContent = '₹50';
        note.style.top = (50 - i * 8) + 'px';
        note.style.zIndex = 10 + i;
        note.setAttribute('draggable', 'true');
        note.addEventListener('dragstart', e => {
          e.dataTransfer.setData('text/plain', 'wallet');
          note.classList.add('dragged');
        });
        note.addEventListener('dragend', e => {
          note.classList.remove('dragged');
        });
        walletImg.appendChild(note);
      }
      // Clear scattered notes
      notesScatter.innerHTML = '';
      for (let i = 0; i < scatteredNotes; i++) {
        const note = document.createElement('div');
        note.className = 'note';
        note.textContent = '₹50';
        note.style.position = 'static';
        note.setAttribute('draggable', 'true');
        note.addEventListener('dragstart', e => {
          e.dataTransfer.setData('text/plain', 'scatter');
          note.classList.add('dragged');
        });
        note.addEventListener('dragend', e => {
          note.classList.remove('dragged');
        });
        notesScatter.appendChild(note);
      }
      budgetAmount.textContent = 150 + notesInWallet * 50;
    }
    renderNotes();
    // Drag in/out logic
    walletImg.addEventListener('dragover', e => e.preventDefault());
    walletImg.addEventListener('drop', e => {
      e.preventDefault();
      if (scatteredNotes > 0) {
        notesInWallet++;
        scatteredNotes--;
        renderNotes();
      }
    });
    notesScatter.addEventListener('dragover', e => e.preventDefault());
    notesScatter.addEventListener('drop', e => {
      e.preventDefault();
      if (notesInWallet > 0) {
        notesInWallet--;
        scatteredNotes++;
        renderNotes();
      }
    });
    document.getElementById('next-budget').addEventListener('click', () => {
      document.getElementById('step-budget').classList.remove('active');
      document.getElementById('step-map').classList.add('active');
    });

    // --- Step 3: Map ---
    let selectedRegion = '';
    document.querySelectorAll('.map-region').forEach(region => {
      region.addEventListener('click', () => {
        document.querySelectorAll('.map-region').forEach(r => r.classList.remove('selected'));
        region.classList.add('selected');
        selectedRegion = region.dataset.region;
        document.getElementById('next-map').disabled = false;
      });
    });
    document.getElementById('next-map').addEventListener('click', () => {
      if (selectedRegion) {
        document.getElementById('step-map').classList.remove('active');
        document.getElementById('step-vending').classList.add('active');
      }
    });

    // --- Step 4: Vending Machine ---
    let selectedCuisine = '';
    const cuisineOptions = document.querySelectorAll('.cuisine');
    const vendingDropzone = document.getElementById('vending-dropzone');
    cuisineOptions.forEach(cuisine => {
      cuisine.addEventListener('dragstart', e => {
        cuisine.classList.add('dragged');
        e.dataTransfer.setData('text/plain', cuisine.dataset.cuisine);
      });
      cuisine.addEventListener('dragend', e => {
        cuisine.classList.remove('dragged');
      });
    });
    vendingDropzone.addEventListener('dragover', e => e.preventDefault());
    vendingDropzone.addEventListener('drop', e => {
      e.preventDefault();
      const cuisine = e.dataTransfer.getData('text/plain');
      if (cuisine) {
        selectedCuisine = cuisine;
        vendingDropzone.textContent = cuisine + ' (click to confirm)';
        vendingDropzone.classList.add('selected');
        document.getElementById('next-cuisine').disabled = false;
      }
    });
    document.getElementById('next-cuisine').addEventListener('click', () => {
      if (selectedCuisine) {
        document.getElementById('step-vending').classList.remove('active');
        document.getElementById('step-fortune').classList.add('active');
      }
    });

    // --- Step 5: Fortune Cookie Button ---
    document.getElementById('fortune-btn').addEventListener('click', () => {
      document.getElementById('step-fortune').classList.remove('active');
      generateReceipt();
      document.getElementById('receipt-container').classList.add('active');
    });

    // --- Step 6: Generate Receipt ---
    function generateReceipt() {
      // Calculate total budget
      const perPerson = 150 + notesInWallet * 50;
      const totalBudget = perPerson * selectedPeople;
      // Find matching restaurants
      let filtered = restaurants.filter(r =>
        (!selectedRegion || r.area.toLowerCase() === selectedRegion) &&
        (!selectedCuisine || selectedCuisine === 'Random' || r.cuisine.toLowerCase().includes(selectedCuisine.toLowerCase()))
      );
      if (selectedCuisine === 'Random') {
        filtered = restaurants.filter(r => r.area.toLowerCase() === selectedRegion);
      }
      if (filtered.length === 0) filtered = restaurants;
      const restaurant = filtered[Math.floor(Math.random() * filtered.length)];
      // Get food items for this restaurant
      let items = foods.filter(f => f.restaurant_id === restaurant.id);
      // Sort by category for budget cuts
      const appetizers = items.filter(i => i.category === 'Appetizer');
      const desserts = items.filter(i => i.category === 'Dessert');
      const drinks = items.filter(i => i.category === 'Drink');
      const mains = items.filter(i => i.category === 'Main Course');
      // Add mains first
      let selected = [...mains];
      let runningTotal = selected.reduce((sum, i) => sum + i.price, 0);
      // Add appetizers, desserts, drinks if budget allows
      function tryAdd(itemsArr) {
        for (let i of itemsArr) {
          if (runningTotal + i.price <= totalBudget) {
            selected.push(i);
            runningTotal += i.price;
          }
        }
      }
      tryAdd(appetizers);
      tryAdd(desserts);
      tryAdd(drinks);
      // If still under budget, add more mains
      for (let i of mains) {
        if (!selected.includes(i) && runningTotal + i.price <= totalBudget) {
          selected.push(i);
          runningTotal += i.price;
        }
      }
      // Format receipt
      let receiptHTML = `
        <div class="receipt-header">
          <div class="receipt-title">${restaurant.name}</div>
          <div class="receipt-meta">${restaurant.location} (${restaurant.area})<br>${restaurant.cuisine}<br>${restaurant.timings}</div>
          <div class="receipt-line"></div>
        </div>
        <div class="receipt-body">
          <div class="receipt-table">
            <div class="receipt-row header"><span>Item</span><span>Cat.</span><span>₹</span></div>
            ${selected.map(item => `<div class="receipt-row"><span>${item.name}</span><span>${item.category}</span><span>${item.price}</span></div>`).join('')}
          </div>
        </div>
        <div class="receipt-line"></div>
        <div class="receipt-footer">
          <div class="receipt-total"><span>Total</span><span>₹${runningTotal}</span></div>
          <div class="receipt-picky"><a href="/picky-eater.html" target="_blank">picky eater? don't worry</a></div>
        </div>
      `;
      document.getElementById('receipt').innerHTML = receiptHTML;
    }
  </script>
</body>
</html>

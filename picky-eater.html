<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Picky Eater - Delhi Eats</title>
  <style>
    body {
      margin: 0;
      background: #ff8b5d;
      font-family: Arial, sans-serif;
      color: #222;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 32px 0 64px 0;
      min-height: 100vh;
    }
    h1, h2 {
      text-align: center;
      margin: 0 0 16px 0;
    }
    .step {
      display: none;
      margin-bottom: 32px;
    }
    .step.active {
      display: block;
    }
    .stick-figures {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 16px;
    }
    .stick-figure {
      font-size: 32px;
      cursor: grab;
      user-select: none;
      transition: opacity 0.2s;
    }
    .stick-figure.dragged {
      opacity: 0.3;
    }
    .stick-dropzone {
      border: 2px dashed #333;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin: 0 auto 16px auto;
      width: 220px;
      background: #fff6f0;
      border-radius: 8px;
    }
    .wallet-area {
      display: flex;
      align-items: flex-end;
      gap: 32px;
      justify-content: center;
      margin-bottom: 24px;
    }
    .wallet-img {
      width: 100px;
      height: 70px;
      background: #2222;
      border-radius: 12px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      position: relative;
      overflow: visible;
    }
    .note {
      width: 80px !important;
      height: 40px !important;
      background: #e0ffb3;
      border: 2px solid #b2c98b;
      border-radius: 8px;
      margin: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      font-family: monospace;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      cursor: grab;
      z-index: 3;
      transition: top 0.2s, left 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      pointer-events: auto;
      opacity: 1;
    }
    .note.removing, .note.adding { animation: none !important; opacity: 1; transform: none; }
    .wallet-img .note { cursor: pointer; }
    .notes-scatter {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-top: 12px;
      min-height: 60px;
    }
    .map-area {
      text-align: center;
      margin-bottom: 24px;
    }
    .map-region {
      display: inline-block;
      margin: 0 8px;
      padding: 4px 10px;
      border-radius: 6px;
      background: #fff6f0;
      border: 2px solid #bbb;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      transition: background 0.2s, border 0.2s;
    }
    .map-region.selected {
      background: #f87c50;
      border: 2px solid #ff3f3f;
      color: #fff;
    }
    .vending-machine-area {
      text-align: center;
      margin-bottom: 24px;
    }
    .vending-ascii {
      font-family: 'Courier New', Courier, monospace;
      font-size: 15px;
      background: #fff6f0;
      display: inline-block;
      padding: 12px 18px;
      border-radius: 10px;
      margin-bottom: 12px;
    }
    .cuisine-options {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 12px 0;
    }
    .cuisine {
      background: #ffe0b2;
      border: 2px solid #f87c50;
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 15px;
      cursor: grab;
      transition: background 0.2s, border 0.2s;
    }
    .cuisine.selected {
      background: #f87c50;
      color: #fff;
      border: 2px solid #ff3f3f;
    }
    .vending-dropzone {
      margin: 18px auto 0 auto;
      width: 180px;
      height: 38px;
      border: 2px dashed #333;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff6f0;
      font-size: 16px;
      color: #888;
    }
    .fortune-btn {
      display: block;
      margin: 32px auto 0 auto;
      background: #fff;
      border: 2px solid #f87c50;
      border-radius: 50%;
      width: 80px;
      height: 80px;
      background-image: url('fortune-cookie.png');
      background-size: 60px 60px;
      background-repeat: no-repeat;
      background-position: center;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(0,0,0,0.13);
      transition: box-shadow 0.2s;
    }
    .fortune-btn:active {
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
    }
    .receipt-container {
      margin: 32px auto 0 auto;
      width: 340px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.18);
      font-family: 'Courier New', Courier, monospace;
      font-size: 15px;
      padding: 24px 18px 12px 18px;
      border: 1.5px dashed #bbb;
      position: relative;
      display: none;
    }
    .receipt-container.active {
      display: block;
    }
    .receipt-header {
      text-align: center;
      margin-bottom: 8px;
    }
    .receipt-title {
      font-size: 20px;
      font-weight: bold;
      letter-spacing: 1px;
    }
    .receipt-meta {
      font-size: 13px;
      color: #666;
      margin-bottom: 4px;
    }
    .receipt-line {
      border-bottom: 1.5px dashed #bbb;
      margin: 8px 0;
    }
    .receipt-table {
      width: 100%;
    }
    .receipt-row {
      display: flex;
      justify-content: space-between;
      font-size: 15px;
      margin: 2px 0;
    }
    .receipt-row.header {
      font-weight: bold;
      border-bottom: 1px solid #eee;
      margin-bottom: 4px;
    }
    .receipt-footer {
      margin-top: 10px;
      text-align: center;
    }
    .receipt-total {
      font-weight: bold;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .receipt-picky {
      font-size: 13px;
      margin-top: 8px;
    }
    .receipt-picky a {
      color: #f87c50;
      text-decoration: underline;
      cursor: pointer;
    }
    .vending-machine {
      width: 320px;
      height: 480px;
      margin: 40px auto 0 auto;
      background: #ffc4c4;
      border: 2px solid #333;
      position: relative;
      display: block;
    }
    .vending-shelves {
      position: absolute;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }
    .vending-shelves .shelf {
      position: absolute;
      left: 0;
      width: 100%;
      height: 0;
      border-top: 2px solid #333;
    }
    .vending-shelves .shelf1 { top: 160px; }
    .vending-shelves .shelf2 { top: 320px; }
    .vending-cans-classic {
      position: absolute;
      top: 32px;
      left: 0;
      width: 100%;
      height: 320px;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 2;
    }
    .vending-cans-row {
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      width: 100%;
      margin-bottom: 32px;
    }
    .can {
      width: 48px;
      height: 82px;
      cursor: pointer;
      position: relative;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      transition: transform 0.2s;
    }
    .can img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: transform 0.2s;
    }
    .can:hover img {
      transform: scale(1.08);
    }
    .tray {
      position: absolute;
      left: 0;
      width: 100%;
      height: 80px;
      bottom: 0;
      background-color: #f49264;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: visible;
      z-index: 5;
    }
    .tray img {
      width: 48px;
      height: 82px;
    }
    .can.rotated {
      animation: canRotate 0.6s cubic-bezier(.77,0,.18,1);
    }
    @keyframes canRotate {
      0% { transform: rotateY(0deg); }
      100% { transform: rotateY(360deg); }
    }
    .can.falling {
      animation: canDropToTrayClassic 1s cubic-bezier(.77,0,.18,1) forwards;
      z-index: 10;
    }
    @keyframes canDropToTrayClassic {
      0% { transform: translateY(0); }
      100% { transform: translateY(240px); }
    }
    .can.pop-anim {
      z-index: 20 !important;
      animation: canPopOutClassic 1.1s cubic-bezier(.77,0,.18,1) forwards;
      transform-origin: center center;
      position: relative;
    }
    @keyframes canPopOutClassic {
      0% { transform: scale(1) translateY(0) rotate(0deg); opacity: 1; }
      60% { transform: scale(1.1) translateY(-20px) rotate(0deg); opacity: 1; }
      100% { transform: scale(2.2) translateY(-80px) rotate(90deg); opacity: 1; }
    }
    .cuisine-receipt {
      position: absolute;
      left: 50%;
      top: 100%;
      width: 48px;
      min-height: 90px;
      background: #fff;
      border-radius: 6px 6px 12px 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.13);
      border: 1.5px dashed #bbb;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      transform: translate(-50%, 0) scaleY(0);
      opacity: 0;
      z-index: 30;
      margin-top: 0px;
      animation: cuisineReceiptPop 0.7s 1.1s cubic-bezier(.77,0,.18,1) forwards;
      overflow: visible;
      pointer-events: none;
    }
    @keyframes cuisineReceiptPop {
      0% { transform: translate(-50%, 0) scaleY(0); opacity: 0; }
      60% { transform: translate(-50%, 10px) scaleY(1.1); opacity: 1; }
      100% { transform: translate(-50%, 20px) scaleY(1); opacity: 1; }
    }
    .cuisine-receipt .cuisine-msg {
      font-size: 0.75rem;
      text-align: center;
      margin: 8px 0 4px 0;
      color: #222;
      font-family: 'Courier New', Courier, monospace;
      line-height: 1.1;
    }
    .cuisine-receipt img {
      width: 32px;
      height: 32px;
      margin: 4px auto 0 auto;
      object-fit: contain;
      display: block;
    }
    .wallet-notes-circle {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 0 auto 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .wallet-img {
      width: 160px;
      height: 110px;
      background: #2222;
      border-radius: 18px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      overflow: visible;
      z-index: 2;
    }
    .notes-circle {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 400px;
      height: 400px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 1;
    }
    .receipt-scatter-container {
      position: relative;
      width: 900px;
      height: 600px;
      margin: 0 auto;
    }
    .receipt.scatter {
      position: absolute;
      animation: fadeInReceipt 0.7s cubic-bezier(.77,0,.18,1);
    }
    @keyframes fadeInReceipt {
      0% { opacity: 0; transform: translateY(40px) scale(0.9); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    @media (max-width: 1000px) {
      .receipt-scatter-container { width: 98vw; height: 80vw; min-width: 0; min-height: 0; }
    }
    @media (max-width: 600px) {
      .wallet-notes-circle, .notes-circle {
        width: 90vw;
        height: 90vw;
        min-width: 0;
        min-height: 0;
      }
      .wallet-img {
        width: 100px;
        height: 70px;
      }
      .note {
        width: 48px !important;
        height: 24px !important;
        font-size: 1.1rem;
      }
    }
    /* Receipt backgrounds */
    .receipt.scatter {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.13);
      padding: 24px 18px 12px 18px;
      border: 1.5px dashed #bbb;
      min-height: 180px;
      animation: fadeInReceipt 0.7s cubic-bezier(.77,0,.18,1);
    }
    .receipt-grid {
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 32px;
      margin-top: 24px;
      background: none;
      box-shadow: none;
    }
    .receipts-1 {
      flex-direction: row;
    }
    .receipts-2 {
      flex-direction: row;
    }
    .receipts-3 {
      flex-direction: row;
    }
    .receipts-4 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 32px;
    }
    .receipts-5 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: 1fr 1fr;
      gap: 32px;
    }
    .receipts-5 > .receipt.scatter:nth-child(1) { grid-column: 1 / 2; grid-row: 1 / 2; }
    .receipts-5 > .receipt.scatter:nth-child(2) { grid-column: 2 / 3; grid-row: 1 / 2; }
    .receipts-5 > .receipt.scatter:nth-child(3) { grid-column: 1 / 2; grid-row: 2 / 3; }
    .receipts-5 > .receipt.scatter:nth-child(4) { grid-column: 2 / 3; grid-row: 2 / 3; }
    .receipts-5 > .receipt.scatter:nth-child(5) { grid-column: 3 / 4; grid-row: 2 / 3; }
    .receipts-6 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: 1fr 1fr;
      gap: 32px;
    }
    .custom-vending-machine {
      width: 420px;
      margin: 0 auto;
      border: 16px solid #3953c6;
      background: #3953c6;
      border-radius: 0;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0;
    }
    .custom-vending-machine .shelf {
      width: 360px;
      height: 110px;
      background: #f7f7b7;
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin: 18px auto 0 auto;
      border: none;
      border-radius: 0;
    }
    .custom-vending-machine .shelf-top {
      margin-top: 32px;
    }
    .custom-vending-machine .shelf-bottom {
      margin-bottom: 0;
    }
    .custom-vending-machine .can-slot {
      width: 80px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .custom-vending-machine .can-img {
      width: 64px;
      height: 90px;
      object-fit: contain;
      background: none;
    }
    .custom-vending-machine .tray {
      width: 360px;
      height: 110px;
      background: #fff;
      margin: 18px auto 32px auto;
      border: none;
      border-radius: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    @media (max-width: 600px) {
      .custom-vending-machine {
        width: 98vw;
        border-width: 8px;
      }
      .custom-vending-machine .shelf,
      .custom-vending-machine .tray {
        width: 90vw;
        min-width: 0;
        max-width: 100vw;
      }
      .custom-vending-machine .can-slot {
        width: 18vw;
        height: 18vw;
      }
      .custom-vending-machine .can-img {
        width: 12vw;
        height: 16vw;
      }
    }
    .can-pop {
      animation: canPopAnim 0.5s cubic-bezier(.77,0,.18,1);
      z-index: 10;
    }
    @keyframes canPopAnim {
      0% { transform: scale(1); }
      60% { transform: scale(1.18); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="logo.png" alt="Delhi Eats Logo" style="position:absolute;top:24px;left:24px;width:120px;height:auto;z-index:10;">
    <!-- Step 1: Number of People (Car & Pegs) -->
    <div class="step active" id="step-people">
      <h2 style="text-align:center;margin-top:60px;">how many people are there?</h2>
      <div id="car-peg-area" style="position:relative;height:320px;margin-bottom:24px;">
        <img id="car-img" src="car-empty.png" alt="Car" style="position:absolute;left:-400px;top:10px;width:340px;height:auto;transition:left 1.2s cubic-bezier(.77,0,.18,1);z-index:2;">
        <div id="peg-dropzone" style="position:absolute;left:50%;top:0;transform:translateX(-50%);width:340px;height:120px;z-index:3;"></div>
      </div>
      <div id="peg-row" style="display:flex;justify-content:center;gap:18px;margin-bottom:18px;margin-top:40px;">
        <img src="peg.png" class="peg-img" draggable="true" data-peg="0" style="width:38px;height:38px;cursor:grab;">
        <img src="peg.png" class="peg-img" draggable="true" data-peg="1" style="width:38px;height:38px;cursor:grab;">
        <img src="peg.png" class="peg-img" draggable="true" data-peg="2" style="width:38px;height:38px;cursor:grab;">
        <img src="peg.png" class="peg-img" draggable="true" data-peg="3" style="width:38px;height:38px;cursor:grab;">
        <img src="peg.png" class="peg-img" draggable="true" data-peg="4" style="width:38px;height:38px;cursor:grab;">
        <img src="peg.png" class="peg-img" draggable="true" data-peg="5" style="width:38px;height:38px;cursor:grab;">
      </div>
      <div id="peg-message" style="text-align:center;font-size:18px;height:28px;margin-bottom:18px;color:#222;font-family:monospace;"></div>
      <button id="next-people" style="margin:24px auto 0 auto;display:block;" disabled>Next</button>
    </div>
    <!-- Step 2: Budget -->
    <div class="step" id="step-budget">
      <h2 style="text-align:center;font-size:2.5rem;margin-top:40px;">how much would you like to pay?</h2>
      <div style="text-align:center;font-size:1.1rem;margin-bottom:18px;">(individually after spending an hour on splitwise)</div>
      <div class="wallet-notes-circle">
        <div class="wallet-img" id="wallet-img">
          <img src="wallet.png" alt="wallet" style="width:160px;height:110px;position:absolute;left:0;top:0;z-index:1;">
        </div>
        <div class="notes-circle" id="notes-circle"></div>
      </div>
      <div style="text-align:center;margin:32px 0 8px 0;font-size:1.2rem;">Drag notes in/out of the wallet</div>
      <div style="text-align:center;font-size:1.4rem;">Current budget: ₹<span id="budget-amount">150</span> per person</div>
      <button id="next-budget" style="margin:32px auto 0 auto;display:block;font-size:1.2rem;padding:8px 24px;">Next</button>
    </div>
    <!-- Step 3: Map -->
    <div class="step" id="step-map">
      <h2>where in delhi?</h2>
      <div class="map-area">
        <pre style="font-size:13px;line-height:1.1;margin-bottom:8px;">   _______
  /       \
 / North   \
|           |
| West  C  East |
|           |
 \ South   /
  \_______/</pre>
        <div>
          <span class="map-region" data-region="north">North</span>
          <span class="map-region" data-region="south">South</span>
          <span class="map-region" data-region="east">East</span>
          <span class="map-region" data-region="west">West</span>
          <span class="map-region" data-region="central">Central</span>
        </div>
      </div>
      <button id="next-map" style="margin:24px auto 0 auto;display:block;" disabled>Next</button>
    </div>
    <!-- Step 4: Vending Machine -->
    <div class="step" id="step-vending">
      <h2 style="text-align:center;margin-bottom:24px;color:#fff;font-family:monospace;font-size:1.5rem;">have a fizz!</h2>
      <div class="custom-vending-machine">
        <div class="shelf shelf-top">
          <div class="can-slot"><img src="images/italian.png" class="can-img" alt="can"></div>
          <div class="can-slot"><img src="images/chinese.png" class="can-img" alt="can"></div>
          <div class="can-slot"><img src="images/northindian.png" class="can-img" alt="can"></div>
        </div>
        <div class="shelf shelf-bottom">
          <div class="can-slot"><img src="images/southindian.png" class="can-img" alt="can"></div>
          <div class="can-slot"><img src="images/panasian.png" class="can-img" alt="can"></div>
          <div class="can-slot"><img src="images/random1.png" class="can-img" alt="can"></div>
        </div>
        <div class="tray"></div>
      </div>
      <button id="next-cuisine" style="margin:24px auto 0 auto;display:block;">Next</button>
    </div>
    <!-- Step 5: Fortune Cookie Button -->
    <div class="step" id="step-fortune">
      <h2>ready for your fortune?</h2>
      <button class="fortune-btn" id="fortune-btn"></button>
    </div>
    <!-- Step 6: Receipt -->
    <div class="receipt-container" id="receipt-container">
      <div class="receipt" id="receipt"></div>
    </div>
  </div>
  <script type="module">
    import { foods } from './restaurant-database.js';
    
    // --- Mock Data ---
    const restaurants = [
      { id: 1, name: 'Chaat Chowk', location: 'Connaught Place', area: 'Central', timings: '10:00 AM - 11:00 PM', cuisine: 'North Indian, Street Food' },
      { id: 2, name: 'South Spice', location: 'Saket', area: 'South', timings: '11:00 AM - 10:00 PM', cuisine: 'South Indian' },
      { id: 3, name: 'Wok Express', location: 'Rajouri Garden', area: 'West', timings: '12:00 PM - 12:00 AM', cuisine: 'Chinese, Asian' },
      { id: 4, name: 'Dolce Vita', location: 'Khan Market', area: 'Central', timings: '10:00 AM - 11:00 PM', cuisine: 'Italian, Desserts' },
      { id: 5, name: 'Sweet Tooth', location: 'Lajpat Nagar', area: 'South', timings: '11:00 AM - 10:00 PM', cuisine: 'Desserts' }
    ];

    // --- Step 1: Car & Pegs ---
    const carImg = document.getElementById('car-img');
    const pegDropzone = document.getElementById('peg-dropzone');
    const pegRow = document.getElementById('peg-row');
    const pegImgs = document.querySelectorAll('.peg-img');
    const pegMessage = document.getElementById('peg-message');
    const nextPeopleBtn = document.getElementById('next-people');
    let pegsOnCar = [];
    const pegMessages = [
      'Ready for a solo ride!',
      'Room for more!',
      'Looking like a party!',
      'Almost full!',
      'One more can join!',
      'Full house!'
    ];
    function updateCarImg() {
      const pegCount = pegsOnCar.length;
      carImg.src = `car-${pegCount === 0 ? 'empty' : pegCount + 'peg' + (pegCount > 1 ? 's' : '')}.png`;
    }
    function updatePegMessage() {
      pegMessage.textContent = pegsOnCar.length > 0 ? pegMessages[pegsOnCar.length - 1] : '';
    }
    function updateNextBtn() {
      nextPeopleBtn.disabled = pegsOnCar.length === 0;
    }
    pegImgs.forEach(peg => {
      peg.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', peg.dataset.peg);
      });
    });
    pegDropzone.addEventListener('dragover', e => e.preventDefault());
    pegDropzone.addEventListener('drop', e => {
      e.preventDefault();
      const pegIdx = e.dataTransfer.getData('text/plain');
      if (!pegsOnCar.includes(pegIdx) && pegsOnCar.length < 6) {
        pegsOnCar.push(pegIdx);
        document.querySelector(`.peg-img[data-peg="${pegIdx}"]`).style.visibility = 'hidden';
        updateCarImg();
        updatePegMessage();
        updateNextBtn();
      }
    });
    // Allow removing pegs by clicking on the car
    pegDropzone.addEventListener('click', e => {
      if (pegsOnCar.length > 0) {
        // Remove the last peg
        const removed = pegsOnCar.pop();
        document.querySelector(`.peg-img[data-peg="${removed}"]`).style.visibility = 'visible';
        updateCarImg();
        updatePegMessage();
        updateNextBtn();
      }
    });
    updateCarImg();
    updatePegMessage();
    updateNextBtn();
    // Animate car in on load
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        carImg.style.left = '50%';
        carImg.style.transform = 'translateX(-50%)';
      }, 300);
    });
    nextPeopleBtn.addEventListener('click', () => {
      if (pegsOnCar.length > 0) {
        document.getElementById('step-people').classList.remove('active');
        document.getElementById('step-budget').classList.add('active');
      }
    });

    // --- Step 2: Wallet & Notes ---
    let notesInWallet = 3;
    let scatteredNotes = 9;
    const walletImg = document.getElementById('wallet-img');
    const notesCircle = document.getElementById('notes-circle');
    const budgetAmount = document.getElementById('budget-amount');
    function renderNotes() {
      // Clear wallet
      walletImg.querySelectorAll('.note').forEach(n => n.remove());
      // Add notes in wallet (stacked vertically)
      for (let i = 0; i < notesInWallet; i++) {
        const note = document.createElement('div');
        note.className = 'note';
        note.textContent = '₹50';
        note.style.top = (60 - i * 18) + 'px';
        note.style.left = '50%';
        note.style.zIndex = 10 + i;
        note.setAttribute('draggable', 'true');
        // Remove note from wallet on click
        note.addEventListener('click', e => {
          note.classList.add('removing');
          setTimeout(() => {
            notesInWallet--;
            scatteredNotes++;
            renderNotes();
          }, 180);
        });
        note.addEventListener('dragstart', e => {
          e.dataTransfer.setData('text/plain', 'wallet');
          note.classList.add('dragged');
        });
        note.addEventListener('dragend', e => {
          note.classList.remove('dragged');
        });
        walletImg.appendChild(note);
      }
      // Clear scattered notes
      notesCircle.innerHTML = '';
      const radius = 160;
      for (let i = 0; i < scatteredNotes; i++) {
        const note = document.createElement('div');
        note.className = 'note';
        note.textContent = '₹50';
        // Place notes in a perfect circle
        const angle = (2 * Math.PI / scatteredNotes) * i - Math.PI / 2;
        const x = 200 + radius * Math.cos(angle);
        const y = 200 + radius * Math.sin(angle);
        note.style.left = x + 'px';
        note.style.top = y + 'px';
        note.setAttribute('draggable', 'true');
        note.addEventListener('dragstart', e => {
          e.dataTransfer.setData('text/plain', 'scatter');
          note.classList.add('dragged');
        });
        note.addEventListener('dragend', e => {
          note.classList.remove('dragged');
        });
        notesCircle.appendChild(note);
      }
      budgetAmount.textContent = 150 + notesInWallet * 50;
    }
    renderNotes();
    // Drag in/out logic
    walletImg.addEventListener('dragover', e => e.preventDefault());
    walletImg.addEventListener('drop', e => {
      e.preventDefault();
      if (scatteredNotes > 0) {
        notesInWallet++;
        scatteredNotes--;
        renderNotes();
      }
    });
    notesCircle.addEventListener('dragover', e => e.preventDefault());
    notesCircle.addEventListener('drop', e => {
      e.preventDefault();
      if (notesInWallet > 0) {
        notesInWallet--;
        scatteredNotes++;
        renderNotes();
      }
    });
    document.getElementById('next-budget').addEventListener('click', () => {
      document.getElementById('step-budget').classList.remove('active');
      document.getElementById('step-map').classList.add('active');
    });

    // --- Step 3: Map ---
    /*
    let selectedRegion = '';
    document.querySelectorAll('.map-region').forEach(region => {
      region.addEventListener('click', () => {
        document.querySelectorAll('.map-region').forEach(r => r.classList.remove('selected'));
        region.classList.add('selected');
        selectedRegion = region.dataset.region;
        document.getElementById('next-map').disabled = false;
      });
    });
    document.getElementById('next-map').addEventListener('click', () => {
      if (selectedRegion) {
        document.getElementById('step-map').classList.remove('active');
        document.getElementById('step-vending').classList.add('active');
      }
    });
    */
    // --- New Foods Database ---
    // ... (add the rest of the CSV content here, formatted as above)

    // --- Step 4: Vending Machine ---
    let selectedCuisine = '';
    const vendingMachine = document.querySelector('.vending-machine');
    const tray = document.getElementById('tray');
    const nextCuisineBtn = document.getElementById('next-cuisine');
    const cuisineList = [
      { name: 'Italian', img: 'images/italian.png' },
      { name: 'Chinese', img: 'images/chinese.png' },
      { name: 'North Indian', img: 'images/northindian.png' },
      { name: 'South Indian', img: 'images/southindian.png' },
      { name: 'Pan Asian', img: 'images/panasian.png' },
      { name: 'Random', img: 'images/random1.png' }
    ];
    // Build classic vending machine layout
    if (!document.querySelector('.vending-cans-classic')) {
      const cansClassic = document.createElement('div');
      cansClassic.className = 'vending-cans-classic';
      const row1 = document.createElement('div');
      row1.className = 'vending-cans-row';
      const row2 = document.createElement('div');
      row2.className = 'vending-cans-row';
      for (let i = 0; i < 3; i++) {
        const can = document.createElement('div');
        can.className = 'can';
        can.dataset.type = 'static';
        can.dataset.cuisine = cuisineList[i].name;
        can.dataset.img = cuisineList[i].img;
        can.innerHTML = `<img src="${cuisineList[i].img}" alt="${cuisineList[i].name}">`;
        row1.appendChild(can);
      }
      for (let i = 3; i < 6; i++) {
        const can = document.createElement('div');
        can.className = 'can';
        can.dataset.type = i === 5 ? 'random' : 'static';
        can.dataset.cuisine = cuisineList[i].name;
        can.dataset.img = cuisineList[i].img;
        can.innerHTML = `<img src="${cuisineList[i].img}" alt="${cuisineList[i].name}">`;
        row2.appendChild(can);
      }
      cansClassic.appendChild(row1);
      cansClassic.appendChild(row2);
      vendingMachine.innerHTML = '';
      // Add shelves
      const shelves = document.createElement('div');
      shelves.className = 'vending-shelves';
      shelves.innerHTML = `<div class='shelf shelf1'></div><div class='shelf shelf2'></div>`;
      vendingMachine.appendChild(shelves);
      vendingMachine.appendChild(cansClassic);
      vendingMachine.appendChild(tray);
      // Add can click logic
      cansClassic.querySelectorAll('.can').forEach(can => {
        can.addEventListener('click', () => {
          if (can.classList.contains('falling') || can.classList.contains('rotated') || can.classList.contains('pop-anim')) return;
          can.classList.add('rotated');
          setTimeout(() => {
            can.classList.remove('rotated');
            can.classList.add('falling');
            setTimeout(() => {
              can.classList.remove('falling');
              tray.innerHTML = '';
              const popCan = can.cloneNode(true);
              popCan.classList.remove('falling');
              popCan.classList.add('pop-anim');
              tray.appendChild(popCan);
              // After pop, show cuisine receipt
              setTimeout(() => {
                let cuisineName = can.dataset.cuisine;
                if (can.dataset.type === 'static') {
                  selectedCuisine = cuisineName;
                } else {
                  // Random: pick one of the other five
                  const randomIdx = Math.floor(Math.random() * 5);
                  selectedCuisine = cuisineList[randomIdx].name;
                  popCan.querySelector('img').src = cuisineList[randomIdx].img;
                  cuisineName = cuisineList[randomIdx].name;
                }
                // Show cuisine receipt
                const cuisineReceipt = document.createElement('div');
                cuisineReceipt.className = 'cuisine-receipt';
                cuisineReceipt.innerHTML = `
                  <div class="cuisine-msg">let us help<br>you out...</div>
                  <img src="image-cuisine/${cuisineName.toLowerCase().replace(/ /g,'_')}.png" alt="${cuisineName}">
                `;
                popCan.appendChild(cuisineReceipt);
                nextCuisineBtn.disabled = false;
              }, 1100);
            }, 1000);
          }, 600);
        });
      });
    }
    nextCuisineBtn.addEventListener('click', () => {
      if (selectedCuisine) {
        document.getElementById('step-vending').classList.remove('active');
        document.getElementById('step-fortune').classList.add('active');
      }
    });

    // --- Step 5: Fortune Cookie Button ---
    document.getElementById('fortune-btn').addEventListener('click', () => {
      document.getElementById('step-fortune').classList.remove('active');
      generateReceipt();
      document.getElementById('receipt-container').classList.add('active');
    });

    // --- Step 6: Generate Receipt ---
    function generateReceipt() {
      // Calculate per-person budget
      const perPerson = 150 + notesInWallet * 50;
      const numPeople = pegsOnCar.length;
      // Find matching restaurants
      // Instead of filtering by region, just pick a random restaurant
      const uniqueRestaurants = Array.from(new Set(foods.map(f => f.restaurant + '|' + f.location)));
      let receiptsHTML = `<div class="receipt-grid ${layoutClass}">`;
      for (let i = 0; i < numPeople; i++) {
        // Pick a random restaurant
        const [restaurant, location] = uniqueRestaurants[Math.floor(Math.random() * uniqueRestaurants.length)].split('|');
        // Get food items for this restaurant
        let items = foods.filter(f => f.restaurant === restaurant && f.location === location);
        // Shuffle items for randomness
        items = items.sort(() => 0.5 - Math.random());
        let selected = [];
        let runningTotal = 0;
        for (let item of items) {
          if (runningTotal + item.price <= perPerson) {
            selected.push(item);
            runningTotal += item.price;
          }
        }
        receiptsHTML += `
          <div class="receipt scatter" style="position:relative;box-shadow:0 8px 32px rgba(0,0,0,0.13);background:#fff;border-radius:12px;padding:24px 18px 12px 18px;border:1.5px dashed #bbb;min-width:220px;max-width:320px;margin:0 auto;">
            <img src="peg.png" alt="peg" style="width:38px;height:38px;position:absolute;left:-18px;top:-18px;z-index:10;">
            <div class="receipt-header" style="margin-top:18px;">
              <div class="receipt-title">${restaurant}</div>
              <div class="receipt-meta">${location}</div>
              <div class="receipt-line"></div>
            </div>
            <div class="receipt-body">
              <div class="receipt-table">
                <div class="receipt-row header"><span>Item</span><span>₹</span></div>
                ${selected.map(item => `<div class="receipt-row"><span>${item.dish}</span><span>${item.price}</span></div>`).join('')}
              </div>
            </div>
            <div class="receipt-line"></div>
            <div class="receipt-footer">
              <div class="receipt-total"><span>Total</span><span>₹${runningTotal}</span></div>
            </div>
          </div>
        `;
      }
      receiptsHTML += '</div>';
      document.getElementById('receipt').innerHTML = receiptsHTML;
    }

    // --- Step 4: Vending Machine ---
    const canSlots = document.querySelectorAll('.custom-vending-machine .can-slot');
    canSlots.forEach(slot => {
      const canImg = slot.querySelector('.can-img');
      canImg.addEventListener('click', () => {
        // Remove animation from all cans
        document.querySelectorAll('.can-img').forEach(img => {
          img.classList.remove('can-pop');
        });
        // Animate clicked can
        canImg.classList.add('can-pop');
        // Set selected cuisine from image alt (or src if you prefer)
        let cuisineName = canImg.alt;
        // If you want to use the filename instead:
        // let cuisineName = canImg.src.split('/').pop().split('.')[0];
        selectedCuisine = cuisineName;
        nextCuisineBtn.disabled = false;
      });
    });
    // Add pop animation style
    const style = document.createElement('style');
    style.innerHTML = `
      .can-pop {
        animation: canPopAnim 0.5s cubic-bezier(.77,0,.18,1);
        z-index: 10;
      }
      @keyframes canPopAnim {
        0% { transform: scale(1); }
        60% { transform: scale(1.18); }
        100% { transform: scale(1); }
      }
    `;
    document.head.appendChild(style);
    // Enable/disable Next button
    nextCuisineBtn.disabled = true;
    nextCuisineBtn.addEventListener('click', () => {
      if (selectedCuisine) {
        document.getElementById('step-vending').classList.remove('active');
        document.getElementById('step-fortune').classList.add('active');
      }
    });
  </script>
</body>
</html>
